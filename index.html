<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Pixel Quest</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Press Start 2P',cursive}

body{
height:100vh;
overflow:hidden;
background:linear-gradient(-45deg,#bde0fe,#ffc8dd,#a2d2ff,#ffafcc);
background-size:400% 400%;
animation:bgMove 18s ease infinite;
display:flex;
justify-content:center;
align-items:center;
color:white;
}

@keyframes bgMove{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

.screen{
position:absolute;
opacity:0;
pointer-events:none;
transform:scale(.9);
transition:.6s ease;
text-align:center;
}

.screen.active{
opacity:1;
pointer-events:auto;
transform:scale(1);
}

.box{
background:rgba(0,0,0,.55);
padding:40px;
border-radius:20px;
width:420px;
box-shadow:0 0 30px rgba(255,255,255,.25);
}

.btn{
margin:10px;
padding:12px 18px;
border:none;
background:#ff8fab;
color:white;
cursor:pointer;
border-radius:12px;
font-size:9px;
transition:.3s;
}
.btn:hover{background:#ff5d8f;transform:scale(1.05)}

.game-wrapper{
display:flex;
gap:40px;
align-items:flex-start;
}

.score-panel{
background:rgba(0,0,0,.6);
padding:20px;
border-radius:15px;
width:230px;
text-align:center;
}

.score-value{font-size:12px;margin-bottom:10px}

.combo-bar{
height:10px;
background:#444;
border-radius:6px;
overflow:hidden;
margin-top:10px;
}

.combo-fill{
height:100%;
width:0%;
background:#ff8fab;
transition:.3s;
}

#gameBoard{
display:grid;
grid-template-columns:repeat(8,45px);
gap:6px;
}

.block{
width:45px;
height:45px;
border-radius:8px;
cursor:pointer;
transition:.2s;
position:relative;
}

.block.fadeIn{animation:fadeIn .6s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

.particle{
position:absolute;
width:6px;
height:6px;
background:white;
border-radius:50%;
pointer-events:none;
animation:particleAnim .6s ease forwards;
}

@keyframes particleAnim{
to{transform:translate(var(--x),var(--y));opacity:0}
}

.notification{
position:fixed;
top:20px;
right:20px;
background:white;
color:black;
padding:15px;
border-radius:18px;
width:280px;
transform:translateX(350px);
opacity:0;
transition:.5s ease;
font-size:9px;
line-height:1.5;
}

.notification.show{
transform:translateX(0);
opacity:1;
}
</style>
</head>

<body>

<div id="menu" class="screen active">
<div class="box">
<h1>VALENTINE PIXEL QUEST</h1>
<button class="btn" onclick="enterGame()">ENTER HER WORLD</button>
<button class="btn" onclick="enterStay()">STAY IN REALITY</button>
</div>
</div>

<div id="game" class="screen">
<div class="game-wrapper">

<div class="score-panel">
<div class="score-value"><span id="score">0</span> / 1870</div>
<div>Combo x<span id="combo">1</span></div>
<div class="combo-bar"><div id="comboFill" class="combo-fill"></div></div>
</div>

<div id="gameBoard"></div>

</div>
</div>

<div id="stay" class="screen">
<div class="box">
<h1>STAY IN REALITY</h1>
<p>Dunia ini tenang... tapi tidak sehangat dunianya.</p>
<button class="btn" onclick="backToMenu()">BACK TO MENU</button>
</div>
</div>

<div id="ending" class="screen">
<div class="box">
<h1>HAPPY VALENTINE ‚ù§Ô∏è</h1>
<p>Kamu adalah warna paling indah dalam hidupku.</p>
<button class="btn" onclick="backToMenu()">BACK TO MENU</button>
</div>
</div>

<div id="notif" class="notification"></div>

<script>
let score=0, combo=1, lastClick=0;
let regenTimers=new Map();
let audioCtx=new (window.AudioContext||window.webkitAudioContext)();

function playNotifSound(){
let osc=audioCtx.createOscillator();
let gain=audioCtx.createGain();
osc.type="sine";
osc.frequency.setValueAtTime(880,audioCtx.currentTime);
gain.gain.setValueAtTime(.1,audioCtx.currentTime);
osc.connect(gain);
gain.connect(audioCtx.destination);
osc.start();
osc.stop(audioCtx.currentTime+.15);
}

function switchScreen(from,to){
document.getElementById(from).classList.remove("active");
setTimeout(()=>document.getElementById(to).classList.add("active"),300);
}

function enterGame(){
switchScreen("menu","game");
generateBoard();
}

function enterStay(){switchScreen("menu","stay")}
function backToMenu(){
score=0;combo=1;
document.getElementById("score").innerText=0;
document.getElementById("combo").innerText=1;
document.getElementById("comboFill").style.width="0%";
switchScreen("game","menu");
switchScreen("stay","menu");
switchScreen("ending","menu");
}

function generateBoard(){
let board=document.getElementById("gameBoard");
board.innerHTML="";
for(let i=0;i<64;i++){
let block=document.createElement("div");
block.className="block";
setRandomColor(block);
block.onclick=(e)=>clickBlock(block,e);
board.appendChild(block);
}
}

function setRandomColor(block){
const colors=["#ff8fab","#ffc8dd","#ff5d8f"];
block.style.background=colors[Math.floor(Math.random()*3)];
block.dataset.state="active";
}

function clickBlock(block,e){
if(block.dataset.state==="blue") return;

let now=Date.now();
let diff=now-lastClick;
lastClick=now;
combo=diff<600?combo+1:1;

document.getElementById("combo").innerText=combo;
document.getElementById("comboFill").style.width=Math.min(combo*10,100)+"%";

block.style.background="#a2d2ff";
block.dataset.state="blue";

score+=10*combo;
document.getElementById("score").innerText=score;

spawnParticles(block);

if(combo>=5) block.style.transform="scale(1.2)";
setTimeout(()=>block.style.transform="scale(1)",200);

scheduleRegen(block);
checkMilestone();

if(score>=1870) setTimeout(()=>switchScreen("game","ending"),800);
}

function spawnParticles(block){
for(let i=0;i<6;i++){
let p=document.createElement("div");
p.className="particle";
p.style.left="20px";
p.style.top="20px";
p.style.setProperty("--x",(Math.random()*60-30)+"px");
p.style.setProperty("--y",(Math.random()*60-30)+"px");
block.appendChild(p);
setTimeout(()=>p.remove(),600);
}
}

function scheduleRegen(block){
if(regenTimers.has(block)) clearTimeout(regenTimers.get(block));
let timer=setTimeout(()=>{
setRandomColor(block);
block.classList.add("fadeIn");
block.dataset.state="active";
},5000);
regenTimers.set(block,timer);
}

function checkMilestone(){
let text="";
if(score===500) text="Kamu selalu bikin aku senyum tiap hari üíï";
if(score===1200) text="Mainnya jago... tapi kamu lebih jago bikin aku jatuh hati üíñ";
if(score===1600) text="Sedikit lagi... seperti perjalananku menuju hatimu üå∏";
if(text!==""){
showNotif(text);
playNotifSound();
}
}

function showNotif(text){
let n=document.getElementById("notif");
n.innerHTML=text;
n.classList.add("show");
setTimeout(()=>n.classList.remove("show"),4000);
}
</script>

</body>
</html>
